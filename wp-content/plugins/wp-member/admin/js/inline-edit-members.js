(function(a){inlineEditMember={init:function(){var b=this,c=a("#inline-edit"),d=a("#bulk-edit");emailRow=a("#bulk-email");b.what="#member-";d.keyup(function(a){if(a.which==27)return inlineEditMember.revert()});a("a.cancel",c).click(function(){return inlineEditMember.revert()});a("a.save",c).click(function(){return inlineEditMember.save(this)});a("td",c).keydown(function(a){if(a.which==13)return inlineEditMember.save(this)});a("a.cancel",d).click(function(){return inlineEditMember.revert()});a("a.cancel",emailRow).click(function(){return inlineEditMember.revert()});a("a.editinline").live("click",function(){inlineEditMember.edit(this);return false});a("#doaction, #doaction2").click(function(c){var d=a(this).attr("id").substr(2);if(a('select[name="'+d+'"]').val()=="edit"){c.preventDefault();b.setBulk()}else if(a('select[name="'+d+'"]').val()=="email"){c.preventDefault();b.setEmail()}else if(a("form#posts-filter tr.inline-editor").length>0){b.revert()}});a("#post-query-submit").mousedown(function(c){b.revert();a('select[name^="action"]').val("-1")})},toggle:function(b){var c=this;a(c.what+c.getId(b)).css("display")=="none"?c.revert():c.edit(b)},setEmail:function(){var b="",c=true;this.revert();a("#bulk-email td").attr("colspan",a(".widefat:first thead th:visible").length);a("table.widefat tbody").prepend(a("#bulk-email"));a("#bulk-email").addClass("inline-editor").show();a('tbody th.check-column input[type="checkbox"]').each(function(d){if(a(this).prop("checked")){c=false;var e=a(this).val(),f;f=a("#inline_"+e+" .username").text()||"no-user-name";b+='<div id="ttleemail'+e+'"><a id="_'+e+'" class="ntdelbutton" title="click to remove">X</a>'+f+"</div>"}});if(c)return this.revert();a("#bulk-email-titles").html(b);a("#bulk-email-titles a").click(function(){var b=a(this).attr("id").substr(1);a('table.widefat input[value="'+b+'"]').prop("checked",false);a("#ttleemail"+b).remove()});a("html, body").animate({scrollTop:0},"fast")},setBulk:function(){var b="",c=true;this.revert();a("#wpmember_registration_date, #wpmember_expire_date").hide();a("#wpmember_registration_date_bulk").change(function(){if(a("#wpmember_registration_date_bulk").val()=="1"){a("#wpmember_registration_date").show()}else{a("#wpmember_registration_date").hide()}});a("#wpmember_expire_date_bulk").change(function(){if(a("#wpmember_expire_date_bulk").val()=="1"){a("#wpmember_expire_date").show()}else{a("#wpmember_expire_date").hide()}});a("#bulk-edit td").attr("colspan",a(".widefat:first thead th:visible").length);a("table.widefat tbody").prepend(a("#bulk-edit"));a("#bulk-edit").addClass("inline-editor").show();a('tbody th.check-column input[type="checkbox"]').each(function(d){if(a(this).prop("checked")){c=false;var e=a(this).val(),f;f=a("#inline_"+e+" .username").text()||"no-user-name";b+='<div id="ttle'+e+'"><a id="_'+e+'" class="ntdelbutton" title="click to remove">X</a>'+f+"</div>"}});if(c)return this.revert();a("#bulk-titles").html(b);a("#bulk-titles a").click(function(){var b=a(this).attr("id").substr(1);a('table.widefat input[value="'+b+'"]').prop("checked",false);a("#ttle"+b).remove()});a("#wpmember_registration_date, #wpmember_expire_date",a("#bulk-edit")).datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true});a("html, body").animate({scrollTop:0},"fast")},edit:function(b){var c=this,d,e,f,g;c.revert();if(typeof b=="object")b=c.getId(b);d=["status","registration","expire"];e=a("#inline-edit").clone(true);a("td",e).attr("colspan",a(".widefat:first thead th:visible").length);if(a(c.what+b).hasClass("alternate"))a(e).addClass("alternate");a(c.what+b).hide().after(e);f=a("#inline_"+b);a(".musername",e).text(a(".username",f).text());for(g=0;g<d.length;g++){if(d[g]=="registration"||d[g]=="expire"){a("#wpmember_"+d[g]+"_date",e).datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true})}a(':input[name="wpmember['+d[g]+']"]',e).val(a("."+d[g],f).text())}a(".level",f).each(function(){var b=a(this).text();if(b){a("ul.wmlevel-checklist :checkbox",e).val(b.split(","))}});a(e).attr("id","edit-"+b).addClass("inline-editor").show();a(".musername",e).focus();return false},save:function(b){var c,d;if(typeof b=="object")b=this.getId(b);a("table.widefat .inline-edit-save .waiting").show();c={action:"wpmember-member-inline-save",_ajax_nonce:wpmember._nonce,user_ID:b};d=a("#edit-"+b+" :input").serialize();c=d+"&"+a.param(c);a.post(ajaxurl,c,function(c){a("table.widefat .inline-edit-save .waiting").hide();if(c){if(-1!=c.indexOf("<tr")){a(inlineEditMember.what+b).remove();a("#edit-"+b).before(c).remove();a(inlineEditMember.what+b).hide().fadeIn()}else{c=c.replace(/<.[^<>]*?>/g,"");a("#edit-"+b+" .inline-edit-save .error").html(c).show()}}else{a("#edit-"+b+" .inline-edit-save .error").html(inlineEditL10n.error).show()}},"html");return false},revert:function(){var b=a("table.widefat tr.inline-editor").attr("id");a("#wpmember_registration_date, #wpmember_expire_date").show();if(b){a("table.widefat .inline-edit-save .waiting").hide();if("bulk-edit"==b){a("table.widefat #bulk-edit").removeClass("inline-editor").hide();a("#bulk-titles").html("");a("#inlineedit").append(a("#bulk-edit"))}else if("bulk-email"==b){a("table.widefat #bulk-email").removeClass("inline-editor").hide();a("#bulk-email-titles").html("");a("#inlineedit").append(a("#bulk-email"))}else{a("#"+b).remove();b=b.substr(b.lastIndexOf("-")+1);a(this.what+b).show()}}return false},getId:function(b){var c=a(b).closest("tr").attr("id"),d=c.split("-");return d[d.length-1]}};a(document).ready(function(){inlineEditMember.init();a(".add-new-h2").click(function(a){a.preventDefault();tb_show("Add New Member","#TB_inline?height=430&width=500&inlineId=wpmember-create-member",null)})})})(jQuery)
