(function(e){if(e("#wpm_reset_reg_defaults").length>0){e("#wpm_reset_reg_defaults").click(function(t){t.preventDefault();e.post(ajaxurl,{action:"wpmember-reset-registration-style",_ajax_nonce:WPMemberReg.resetNonce},function(t){if(t!="0"||t!="-1"){for(x in t){e('input[name="wpmember['+x+']"]').val(t[x])}wpmColorPicker.init()}},"json")})}wpmRegCustomiser={init:function(){var t=this;t.fields=wpmember.fields;t.count=t.fields.length;e(document).on("click","a.add-select-option",function(t){t.preventDefault();current=e(this).closest("li");clone=current.clone();clone.find("input").keydown(function(t){id=e(this).closest("ul").attr("id").substring(13);if(t.which==13){t.preventDefault();wpmRegCustomiser.revert(e(this))}}).val("").focus();current.after(clone)});e(document).on("click","a.add-radio-option",function(t){t.preventDefault();current=e(this).closest("li");clone=current.clone();current.after(clone)});e(document).on("click","a.remove-field-element, a.remove-radio-option, a.remove-select-option",function(t){t.preventDefault();e(this).closest("li").remove()});e(document).on("click",".wpm-inline-edit",function(){var t=e(this).attr("id").substring(16);e(this).hide();container=e(this).closest("span.editable-contain");edit=e(container).find(".wpm-edit-box");edit.show().focus();e("#wpm_edit_box_"+t+",.wpm_edit_box_"+t).keydown(function(t){if(t.which==13){t.preventDefault();wpmRegCustomiser.revert(e(this))}})});for(i=0;i<t.count;i++){field=t.fields[i];if(typeof field.type==="undefined"){continue}e("#sortable").append('<li class="menu-item ui-draggable wpmember-form-element">'+wpmRegCustomiser.create_field(field,i+1)+"</li>")}wpmRegCustomiser.make_editable();e("#sortable").sortable({revert:true,placeholder:"sortable-placeholder field-placeholder",receive:function(n,r){dropped=e(this).data().sortable.currentItem;field_type=r.sender.attr("id").substring(15);t.count++;id=wpmRegCustomiser.get_unique_id("field_id_");field={type:field_type,label:"Label click to edit",id:id};switch(field_type){case"select":field.select=["option 1","option 2"];break;case"radio":field.option=["option 1","option 2"];break;case"terms_conditions":field.label="Terms & Conditions";break;case"subscriptions":field.label="Subscription Options";break;case"coupon":field.label="Coupon Code";break;case"antispam":field.label="Anti-Spam Math question";break;case"subscription_intro":field.label="";break}dropped.html(wpmRegCustomiser.create_field(field,t.count));dropped.addClass("wpmember-form-element");wpmRegCustomiser.make_editable()}});e("#wpmember_reg_cust_fields,#wpmember_reg_predefined_form_fields").droppable({revert:true,placeholder:"sortable-placeholder field-placeholder",hoverClass:"ui-state-active",drop:function(t,n){e(n.draggable).remove()},tolerance:"intersect"});e("#wpm_form_field_bin li").dblclick(function(){field_type=e(this).attr("id").substring(15);id=wpmRegCustomiser.get_unique_id("field_id_");field={type:field_type,label:"Label click to edit",id:id};switch(field_type){case"select":field.select=["option 1","option 2"];break;case"radio":field.option=["option 1","option 2"];break;case"terms_conditions":field.label="Terms & Conditions";break;case"subscriptions":field.label="Subscription Options";break;case"coupon":field.label="Coupon Code";break;case"antispam":field.label="Anti-Spam Math question";break;case"subscription_intro":field.label="";break}t.count++;e("#sortable").append('<li class="menu-item ui-draggable wpmember-form-element">'+wpmRegCustomiser.create_field(field,t.count)+"</li>");wpmRegCustomiser.make_editable()});e(".draggable").draggable({connectToSortable:"#sortable",helper:"clone",revert:"invalid"});e(".draggable-form-element").draggable({connectToSortable:"#wpmember_reg_cust_fields",helper:"original",revert:true})},revert:function(t){container=t.closest("span.editable-contain");editable=e(container).find(".wpm-editable-content");editableWrap=e(container).find("span.wpm-inline-edit");if(!editable.is("select")){editable.text(t.val());t.hide()}else{container.find(".wpm-edit-box").hide()}editableWrap.show()},get_unique_id:function(t){i=1;while(e('.wpm-element-id[value="'+t+i+'"] ').length>0){i++}return t+i},make_editable:function(){e(".wpmember-form-element").hover(function(){e(this).addClass("wpm-form-element-hover");e(this).find(".wpm-field-options").show()},function(){e(this).removeClass("wpm-form-element-hover");e(this).find(".wpm-field-options").hide()});e(".wpm-edit-box:input").blur(function(){wpmRegCustomiser.revert(e(this))})},create_field:function(e,t){switch(e.type){case"input":field_html='<div style="width:190px;float: left;">'+wpmRegCustomiser.editable_content("label",e.label,t)+"</div>"+'<input type="text" value="" />';break;case"date_input":field_html='<div style="width:190px;float: left;">'+wpmRegCustomiser.editable_content("label",e.label,t)+"</div>"+'<input type="text" value="" />';break;case"textarea":field_html='<div style="width:190px;float: left;">'+wpmRegCustomiser.editable_content("label",e.label,t)+"</div>"+'<textarea style="vertical-align: top;"></textarea>';break;case"checkbox":field_html='<div style="width:190px;float: left;">'+wpmRegCustomiser.editable_content("label",e.label,t)+"</div>"+'<input type="checkbox" />';break;case"radio":field_html='<div style="width:190px;float: left;">'+wpmRegCustomiser.editable_content("label",e.label,t)+"</div>"+wpmRegCustomiser.editable_radio("option",e.label,t,e.option);break;case"select":field_html='<div style="width:190px;float: left;">'+wpmRegCustomiser.editable_content("label",e.label,t)+"</div>"+wpmRegCustomiser.editable_select("select",e.label,t,e.select);break;case"subscriptions":case"subscription_intro":case"terms_conditions":case"coupon":case"antispam":return'<div style="width:190px;float: left;">'+e.label+"</div>"+'<input type="hidden" name="wpmember[form]['+t+'][type]" value ="'+e.type+'" />'+'<input type="hidden" name="wpmember[form]['+t+'][label]" value ="'+e.label+'" />'+'<div class="wpm-field-options"><a href="#" class="remove-field-element">remove</a></div>';break;default:return}required=e.required==1?'checked="checked"':"";return field_html+'<input type="hidden" name="wpmember[form]['+t+'][type]" value ="'+e.type+'" />'+'<div class="wpm-field-options">'+wpmRegCustomiser.editable_content("id",e.id,t)+'| <label> <input type="checkbox" value="1" name="wpmember[form]['+t+'][required]" '+required+" /> Required </label>"+'| <a href="#" class="remove-field-element">remove</a>'+"</div>"},editable_content:function(e,t,n){if(e=="id"){element_class="wpm-edit-box wpm-element-id"}else{element_class="wpm-edit-box"}html='<span class="editable-contain"><span class="wpm-inline-edit" id="wpm_inline_edit_'+n+""+e+'">'+'<span class="wpm-editable-content">'+t+"</span>"+'<img src="'+wpm_reg_custom.edit_img+'">'+"</span>"+'<input type="text" style="display:none" value="'+t+'" class="'+element_class+'" name="wpmember[form]['+n+"]["+e+']" id="wpm_edit_box_'+n+""+e+'"/>'+"</span>";return html},editable_select:function(e,t,n,r){html='<span class="editable-contain"><span class="wpm-inline-edit" id="wpm_inline_edit_'+n+""+e+'">'+'<select class="wpm-editable-content">'+'<option value="1"> option</option>'+"</select>"+'<img src="'+wpm_reg_custom.edit_img+'">'+"</span>"+'<ul class="wpm-edit-box" style="display:none" id="wpm_edit_box_'+n+""+e+'">';for(j=0;j<r.length;j++){html=html+"<li>"+wpmRegCustomiser.select_input(r[j],n,e)+"</li>"}html=html+"</ul></span>";return html},editable_radio:function(e,t,n,r){html='<ul style="display: inline-block;">';for(j=0;j<r.length;j++){html=html+'<li><input type="radio" />   '+'<span class="editable-contain">'+'<span class="wpm-inline-edit" id="wpm_inline_edit_'+n+""+e+j+'">'+'<span class="wpm-editable-content">'+r[j]+"</span>"+'<img src="'+wpm_reg_custom.edit_img+'">'+"</span>"+'<input type="text" style="display:none" value="'+r[j]+'" class="wpm-element-id wpm-edit-box" name="wpmember[form]['+n+"]["+e+'][]" id="wpm_edit_box_'+n+""+e+j+'"/>'+'<a href="#" class="add-radio-option">add</a> | <a href="#" class="remove-radio-option">remove</a></li>'+"</span>"}html=html+"</ul>";return html},select_input:function(e,t,n){return'<input type="text" value="'+e+'" class="wpm_edit_box_'+t+""+n+' regular-text" name="wpmember[form]['+t+"]["+n+'][]"/>'+'<a href="#" class="add-select-option">add</a> | <a href="#" class="remove-select-option">remove</a>'}};wpmColorPicker={init:function(){e(".wpm-color-picker").each(function(t,n){a=e(n).val();cp_eg=e(n).parent().find(".wpm-color-picker-example").css("background",a)});e(".pickcolor").click(function(t){cp_par=e(this).closest(".wpm-color-picker-container");colorPicker=e(cp_par).find(".colorPickerDiv");example=e(cp_par).find(".wpm-color-picker-example");input=e(cp_par).find(".wpm-color-picker");e.farbtastic(colorPicker,function(t){e(input).val(t);example.css("background",t)});colorPicker.show();t.preventDefault();e(document).mousedown(function(){e(colorPicker).hide()})})}};e(document).ready(function(){wpmRegCustomiser.init();wpmColorPicker.init()})})(jQuery)